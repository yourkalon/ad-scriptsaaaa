<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase Visitor Counter Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f8f9fa;
      color: #333;
      text-align: center;
      padding-top: 80px;
    }
    h1 {
      color: #007BFF;
    }
    #visitorCount {
      margin-top: 20px;
      font-size: 20px;
      font-weight: bold;
      color: #28a745;
    }
    footer {
      position: fixed;
      bottom: 10px;
      width: 100%;
      text-align: center;
      color: #666;
      font-size: 14px;
    }
  </style>

  <!-- Firebase Visitor Counter Script -->
  <script type="module">
    // üîπ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ Firebase config (‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ü‡¶ó‡ßá‡¶á ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßã)
    const firebaseConfig = {
      apiKey: "AIzaSyCediRkFLFfRhnQWG9sCAEek_6-BMcNXXY",
      authDomain: "my-website-counter56.firebaseapp.com",
      projectId: "my-website-counter56",
      storageBucket: "my-website-counter56.firebasestorage.app",
      messagingSenderId: "538008405213",
      appId: "1:538008405213:web:eed758b2a5d8466f944734",
      measurementId: "G-WXMHRXJ7SZ"
    };

    // Firebase import
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getFirestore,
      doc,
      getDoc,
      setDoc,
      updateDoc,
      serverTimestamp,
      increment
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const COUNTER_DOC = doc(db, "site_counters", "global");

    function todayString() {
      const d = new Date();
      return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, "0")}-${String(d.getDate()).padStart(2, "0")}`;
    }

    async function ensureDocExists() {
      const snap = await getDoc(COUNTER_DOC);
      if (!snap.exists()) {
        await setDoc(COUNTER_DOC, {
          pageViews: 0,
          uniqueToday: 0,
          lastUniqueDate: "",
          updatedAt: serverTimestamp()
        });
      }
    }

    async function incrementCounters() {
      await ensureDocExists();
      await updateDoc(COUNTER_DOC, { pageViews: increment(1), updatedAt: serverTimestamp() });

      const key = "my_site_last_visit_date";
      const last = localStorage.getItem(key);
      const today = todayString();

      const snap = await getDoc(COUNTER_DOC);
      const data = snap.exists() ? snap.data() : {};

      if (last !== today) {
        if (data.lastUniqueDate === today) {
          await updateDoc(COUNTER_DOC, { uniqueToday: increment(1) });
        } else {
          await updateDoc(COUNTER_DOC, {
            uniqueToday: 1,
            lastUniqueDate: today
          });
        }
        localStorage.setItem(key, today);
      }

      const latest = await getDoc(COUNTER_DOC);
      if (latest.exists()) {
        const vals = latest.data();
        console.log(`üìä Page Views: ${vals.pageViews}, Unique Today: ${vals.uniqueToday}`);
        document.getElementById("visitorCount").innerText =
          `üëÅÔ∏è ‡¶Æ‡ßã‡¶ü ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü: ${vals.pageViews} | üë§ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶á‡¶â‡¶®‡¶ø‡¶ï: ${vals.uniqueToday}`;
      }
    }

    incrementCounters();
  </script>
</head>
<body>
  <h1>üî• Simple Firebase Visitor Counter üî•</h1>
  <p>‡¶è‡¶á ‡¶™‡ßá‡¶ú‡ßá ‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶¨‡¶æ‡¶∞ ‡¶¢‡ßÅ‡¶ï‡¶≤‡ßá Firebase ‡¶è ‡¶≠‡¶ø‡¶ú‡¶ø‡¶ü ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶¨‡¶æ‡ßú‡¶¨‡ßá‡•§</p>

  <div id="visitorCount">Loading visitor count...</div>

  <footer>Created by Parces | Powered by Firebase</footer>
</body>
</html>
